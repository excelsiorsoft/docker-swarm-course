
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                         
$ cat create-machine.sh                                                                                                                                         
#!/bin/bash                                                                                                                                                     
                                                                                                                                                                
for i in 1 2 3; do                                                                                                                                              
    docker-machine create -d virtualbox swarm-$i                                                                                                                
done                                                                                                                                                            
                                                                                                                                                                
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                         
$ ./create-machine.sh                                                                                                                                           
Running pre-create checks...                                                                                                                                    
(swarm-1) Default Boot2Docker ISO is out-of-date, downloading the latest release...                                                                             
(swarm-1) Latest release for github.com/boot2docker/boot2docker is v17.09.0-ce                                                                                  
(swarm-1) Downloading C:\Users\senya\.docker\machine\cache\boot2docker.iso from https://github.com/boot2docker/boot2docker/releases/download/v17.09.0-ce/boot2do
ker.iso...                                                                                                                                                      
(swarm-1) 0%....10%....20%....30%....40%....50%....60%....70%....80%....90%....100%                                                                             
Creating machine...                                                                                                                                             
(swarm-1) Copying C:\Users\senya\.docker\machine\cache\boot2docker.iso to C:\Users\senya\.docker\machine\machines\swarm-1\boot2docker.iso...                    
(swarm-1) Creating VirtualBox VM...                                                                                                                             
(swarm-1) Creating SSH key...                                                                                                                                   
(swarm-1) Starting the VM...                                                                                                                                    
(swarm-1) Check network to re-create if needed...                                                                                                               
(swarm-1) Waiting for an IP...                                                                                                                                  
Waiting for machine to be running, this may take a few minutes...                                                                                               
Detecting operating system of created instance...                                                                                                               
Waiting for SSH to be available...                                                                                                                              
Detecting the provisioner...                                                                                                                                    
Provisioning with boot2docker...                                                                                                                                
Copying certs to the local machine directory...                                                                                                                 
Copying certs to the remote machine...                                                                                                                          
Setting Docker configuration on the remote daemon...                                                                                                            
Checking connection to Docker...                                                                                                                                
Docker is up and running!                                                                                                                                       
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: C:\Program Files\Docker Toolbox\docker-machine.exe env swarm
1                                                                                                                                                               
Running pre-create checks...                                                                                                                                    
Creating machine...                                                                                                                                             
(swarm-2) Copying C:\Users\senya\.docker\machine\cache\boot2docker.iso to C:\Users\senya\.docker\machine\machines\swarm-2\boot2docker.iso...                    
(swarm-2) Creating VirtualBox VM...                                                                                                                             
(swarm-2) Creating SSH key...                                                                                                                                   
(swarm-2) Starting the VM...                                                                                                                                    
(swarm-2) Check network to re-create if needed...                                                                                                               
(swarm-2) Waiting for an IP...                                                                                                                                  
Waiting for machine to be running, this may take a few minutes...                                                                                               
Detecting operating system of created instance...                                                                                                               
Waiting for SSH to be available...                                                                                                                              
Detecting the provisioner...                                                                                                                                    
Provisioning with boot2docker...                                                                                                                                
Copying certs to the local machine directory...                                                                                                                 
Copying certs to the remote machine...                                                                                                                          
Setting Docker configuration on the remote daemon...                                                                                                            
Checking connection to Docker...                                                                                                                                
Docker is up and running!                                                                                                                                       
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: C:\Program Files\Docker Toolbox\docker-machine.exe env swarm
2                                                                                                                                                               
Running pre-create checks...                                                                                                                                    
Creating machine...                                                                                                                                             
(swarm-3) Copying C:\Users\senya\.docker\machine\cache\boot2docker.iso to C:\Users\senya\.docker\machine\machines\swarm-3\boot2docker.iso...                    
(swarm-3) Creating VirtualBox VM...                                                                                                                             
(swarm-3) Creating SSH key...                                                                                                                                   
(swarm-3) Starting the VM...                                                                                                                                    
(swarm-3) Check network to re-create if needed...                                                                                                               
(swarm-3) Waiting for an IP...                                                                                                                                  
Waiting for machine to be running, this may take a few minutes...                                                                                               
Detecting operating system of created instance...                                                                                                               
Waiting for SSH to be available...                                                                                                                              
Detecting the provisioner...                                                                                                                                    
Provisioning with boot2docker...                                                                                                                                
Copying certs to the local machine directory...                                                                                                                 
Copying certs to the remote machine...                                                                                                                          
Setting Docker configuration on the remote daemon...                                                                                                            
Checking connection to Docker...                                                                                                                                
Docker is up and running!                                                                                                                                       
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: C:\Program Files\Docker Toolbox\docker-machine.exe env swarm
3                                                                                                                                                               
                                                                                                                                                                
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                         
$ 

Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)
$ docker-machine ls
NAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS
default   *        virtualbox   Running   tcp://192.168.99.100:2376           v17.07.0-ce
swarm-1   -        virtualbox   Running   tcp://192.168.99.105:2376           v17.09.0-ce
swarm-2   -        virtualbox   Running   tcp://192.168.99.106:2376           v17.09.0-ce
swarm-3   -        virtualbox   Running   tcp://192.168.99.107:2376           v17.09.0-ce


Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                                                                                                                                       
$ eval "$(docker-machine env swarm-1)"                                                                          
                                                                                                                
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                         
$ docker-machine ls                                                                                             
NAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS              
default   -        virtualbox   Running   tcp://192.168.99.100:2376           v17.07.0-ce                       
swarm-1   *        virtualbox   Running   tcp://192.168.99.105:2376           v17.09.0-ce                       
swarm-2   -        virtualbox   Running   tcp://192.168.99.106:2376           v17.09.0-ce                       
swarm-3   -        virtualbox   Running   tcp://192.168.99.107:2376           v17.09.0-ce                       
                                                                                                                
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                         

$ docker swarm init --advertise-addr $(docker-machine ip swarm-1)                                                                            
Swarm initialized: current node (yecar1k1724th4e6ws8msk07i) is now a manager.                                                                                                                                                                               
                                                                                                                                             
To add a worker to this swarm, run the following command:                                                                                    
                                                                                                                                             
    docker swarm join --token SWMTKN-1-0etn64puo2bv6fs9lw87fytk8sl8u8s7zxdd1l8plm7q6isj5l-9981lu2143cnxgofi7qgbhdei 192.168.99.105:2377      
                                                                                                                                             
To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.                                           
                                                                                                                                             
                                                                                                                                             
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                      
$                                        

Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)
$ docker swarm join-token manager
To add a manager to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-0etn64puo2bv6fs9lw87fytk8sl8u8s7zxdd1l8plm7q6isj5l-9yuyeouk0g5r9nb0mym6wzvqx 192.168.99.105:2377

$ docker swarm join-token worker
To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-0etn64puo2bv6fs9lw87fytk8sl8u8s7zxdd1l8plm7q6isj5l-9981lu2143cnxgofi7qgbhdei 192.168.99.105:2377



$ JOIN_TOKEN=$(docker swarm join-token worker)                                                                                                                   	
                                                                                                                                                                 
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                          
$ echo JOIN_TOKEN                                                                                                                                                
JOIN_TOKEN                                                                                                                                                       
                                                                                                                                                                 
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                          
$ echo $JOIN_TOKEN                                                                                                                                               
To add a worker to this swarm, run the following command: docker swarm join --token SWMTKN-1-0etn64puo2bv6fs9lw87fytk8sl8u8s7zxdd1l8plm7q6isj5l-9981lu2143cnxgofi
7qgbhdei 192.168.99.105:2377                                                                                                                                     
                                                                                                                                                                 
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                          
$ docker swarm join-token --help                                                                                                                                 
                                                                                                                                                                 
Usage:  docker swarm join-token [OPTIONS] (worker|manager)                                                                                                       
                                                                                                                                                                 
Manage join tokens                                                                                                                                               
                                                                                                                                                                 
Options:                                                                                                                                                         
      --help     Print usage                                                                                                                                     
  -q, --quiet    Only display token                                                                                                                              
      --rotate   Rotate join token                                                                                                                               
                                                                                                                                                                 
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                          
$ JOIN_TOKEN=$(docker swarm join-token -q worker)                                                                                                                
                                                                                                                                                                 
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                          
$ echo $JOIN_TOKEN                                                                                                                                               
SWMTKN-1-0etn64puo2bv6fs9lw87fytk8sl8u8s7zxdd1l8plm7q6isj5l-9981lu2143cnxgofi7qgbhdei                                                                            
                                                                                                                                                                 
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                          
$                                                                                                                                                                
                                                                                                                                                                 
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                                                                                                                                                                                    
$ docker-machine ls                                                                                       
NAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS        
default   -        virtualbox   Running   tcp://192.168.99.100:2376           v17.07.0-ce                 
swarm-1   *        virtualbox   Running   tcp://192.168.99.105:2376           v17.09.0-ce                 
swarm-2   -        virtualbox   Running   tcp://192.168.99.106:2376           v17.09.0-ce                 
swarm-3   -        virtualbox   Running   tcp://192.168.99.107:2376           v17.09.0-ce                 
                                                                                                          
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.2 (master)                   
$ docker node ls                                                                                          
ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS  
yecar1k1724th4e6ws8msk07i *   swarm-1             Ready               Active              Leader          
        
$ docker-machine rm -f swarm-1 swarm-2 swarm-3
About to remove swarm-1, swarm-2, swarm-3
WARNING: This action will delete both local reference and remote instance.
Successfully removed swarm-1
Successfully removed swarm-2
Successfully removed swarm-3

Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.5 (master)
$ docker-machine ls
NAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS
default   *        virtualbox   Running   tcp://192.168.99.100:2376           v17.07.0-ce


Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.5 (master)                                                                                           		
$ ./add-worker-node.sh                                                                                                                                                            
Running pre-create checks...                                                                                                                                                      
Creating machine...                                                                                                                                                               
(swarm-1) Copying C:\Users\senya\.docker\machine\cache\boot2docker.iso to C:\Users\senya\.docker\machine\machines\swarm-1\boot2docker.iso...                                      
(swarm-1) Creating VirtualBox VM...                                                                                                                                               
(swarm-1) Creating SSH key...                                                                                                                                                     
(swarm-1) Starting the VM...                                                                                                                                                      
(swarm-1) Check network to re-create if needed...                                                                                                                                 
(swarm-1) Waiting for an IP...                                                                                                                                                    
Waiting for machine to be running, this may take a few minutes...                                                                                                                 
Detecting operating system of created instance...                                                                                                                                 
Waiting for SSH to be available...                                                                                                                                                
Detecting the provisioner...                                                                                                                                                      
Provisioning with boot2docker...                                                                                                                                                  
Copying certs to the local machine directory...                                                                                                                                   
Copying certs to the remote machine...                                                                                                                                            
Setting Docker configuration on the remote daemon...                                                                                                                              
Checking connection to Docker...                                                                                                                                                  
Docker is up and running!                                                                                                                                                         
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: C:\Program Files\Docker Toolbox\docker-machine.exe env swarm-1                
Running pre-create checks...                                                                                                                                                      
Creating machine...                                                                                                                                                               
(swarm-2) Copying C:\Users\senya\.docker\machine\cache\boot2docker.iso to C:\Users\senya\.docker\machine\machines\swarm-2\boot2docker.iso...                                      
(swarm-2) Creating VirtualBox VM...                                                                                                                                               
(swarm-2) Creating SSH key...                                                                                                                                                     
(swarm-2) Starting the VM...                                                                                                                                                      
(swarm-2) Check network to re-create if needed...                                                                                                                                 
(swarm-2) Waiting for an IP...                                                                                                                                                    
Waiting for machine to be running, this may take a few minutes...                                                                                                                 
Detecting operating system of created instance...                                                                                                                                 
Waiting for SSH to be available...                                                                                                                                                
Detecting the provisioner...                                                                                                                                                      
Provisioning with boot2docker...                                                                                                                                                  
Copying certs to the local machine directory...                                                                                                                                   
Copying certs to the remote machine...                                                                                                                                            
Setting Docker configuration on the remote daemon...                                                                                                                              
Checking connection to Docker...                                                                                                                                                  
Docker is up and running!                                                                                                                                                         
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: C:\Program Files\Docker Toolbox\docker-machine.exe env swarm-2                
Running pre-create checks...                                                                                                                                                      
Creating machine...                                                                                                                                                               
(swarm-3) Copying C:\Users\senya\.docker\machine\cache\boot2docker.iso to C:\Users\senya\.docker\machine\machines\swarm-3\boot2docker.iso...                                      
(swarm-3) Creating VirtualBox VM...                                                                                                                                               
(swarm-3) Creating SSH key...                                                                                                                                                     
(swarm-3) Starting the VM...                                                                                                                                                      
(swarm-3) Check network to re-create if needed...                                                                                                                                 
(swarm-3) Waiting for an IP...                                                                                                                                                    
Waiting for machine to be running, this may take a few minutes...                                                                                                                 
Detecting operating system of created instance...                                                                                                                                 
Waiting for SSH to be available...                                                                                                                                                
Detecting the provisioner...                                                                                                                                                      
Provisioning with boot2docker...                                                                                                                                                  
Copying certs to the local machine directory...                                                                                                                                   
Copying certs to the remote machine...                                                                                                                                            
Setting Docker configuration on the remote daemon...                                                                                                                              
Checking connection to Docker...                                                                                                                                                  
Docker is up and running!                                                                                                                                                         
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: C:\Program Files\Docker Toolbox\docker-machine.exe env swarm-3                
Swarm initialized: current node (o820uob9vko5m5zvyni7e5rak) is now a manager.                                                                                                     
                                                                                                                                                                                  
To add a worker to this swarm, run the following command:                                                                                                                         
                                                                                                                                                                                  
    docker swarm join --token SWMTKN-1-3ala0qilxyptt47zpbr53nhoc09agtw14w98xzxkv87qexcpug-b9xnoer9m2gxhjb35dwduau8y 192.168.99.108:2377                                           
                                                                                                                                                                                  
To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.                                                                                
                                                                                                                                                                                  
This node joined a swarm as a worker.                                                                                                                                             
This node joined a swarm as a worker.                                                                                                                                             
                                                                                                                                                                                  
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.5 (master)                                                                                           
$ docker node ls                                                                                                                                                                  
Error response from daemon: This node is not a swarm manager. Use "docker swarm init" or "docker swarm join" to connect this node to swarm and try again.                         
                                                                                                                                                                                  
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.5 (master)                                                                                           
$ eval "$(docker-machine env swarm-1)"                                                                                                                                            
                                                                                                                                                                                  
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.5 (master)                                                                                           
$ eval $(docker-machine env swarm-1)                                                                                                                                              
                                                                                                                                                                                  
Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.5 (master)                                                                                           
$ docker node ls                                                                                                                                                                  
ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS                                                                          
o820uob9vko5m5zvyni7e5rak *   swarm-1             Ready               Active              Leader                                                                                  
m7ndyiox5838jnraxpz2wtuwt     swarm-2             Ready               Active                                                                                                      
55xnk5ktfasccyu0v8htukd2f     swarm-3             Ready               Active                                                                                                      
 
 
$ docker-machine ls
NAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS
default   -        virtualbox   Running   tcp://192.168.99.100:2376           v17.07.0-ce
swarm-1   *        virtualbox   Running   tcp://192.168.99.108:2376           v17.09.0-ce
swarm-2   -        virtualbox   Running   tcp://192.168.99.109:2376           v17.09.0-ce
swarm-3   -        virtualbox   Running   tcp://192.168.99.110:2376           v17.09.0-ce                                                                                                                                                                               



Simeon@LAPTOP-P0PO4U7C MSYS ~/source/docker-swarm-course/chapter-2/section-2.5 (master)
$ docker swarm ca --rotate
desired root digest: sha256:a869c20133d1d5180648a96395ba4023b3f56adb899800d3cac37808991a48e2
  rotated TLS certificates:  [==================================================>] 3/3 nodes
  rotated CA certificates:   [==================================================>] 3/3 nodes
-----BEGIN CERTIFICATE-----
MIIBajCCARCgAwIBAgIUNlC/S39I4M2/tDS36jkFMQqOP1UwCgYIKoZIzj0EAwIw
EzERMA8GA1UEAxMIc3dhcm0tY2EwHhcNMTcxMDA3MjM1NjAwWhcNMzcxMDAyMjM1
NjAwWjATMREwDwYDVQQDEwhzd2FybS1jYTBZMBMGByqGSM49AgEGCCqGSM49AwEH
A0IABEzS6ZYCe5orAtM6NsA7zfdUG7n0hpJDgJxF9SPe3Z3eAMYHQ4cu98wu5Y/i
auZ7i1kCa7TLc3amAD9YcEY0nv6jQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMB
Af8EBTADAQH/MB0GA1UdDgQWBBShrkCS5bGWwkrlKoK6wRkWLVVkQDAKBggqhkjO
PQQDAgNIADBFAiEAoWQUOwzHVBv6y233OTDr0ZPrnPe9GYL3v9YXaVkQld4CIGqb
bu1579kFx4sChY/6eE7thhAoui3fxGsOPlGX0lu9
-----END CERTIFICATE-----

                                                                                                                                                                                  